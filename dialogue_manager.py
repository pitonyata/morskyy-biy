# dialogue_manager.py
import random
from typing import Optional


class DialogueManager:
    """Менеджер діалогів для AI-робота в грі морський бій"""

    def __init__(self, difficulty: str = "easy"):
        self.difficulty = difficulty
        self.robot_name = "AI-Адмірал" if difficulty == "hard" else "AI-Капітан"

        # Бази діалогів для різних подій
        self.dialogues = {
            # Початок гри
            "game_start": [
                f"Готуйся до поразки, людино!",
                f"Я знищу твій флот!",
                f"Ти не маєш жодних шансів проти мене!",
                f"Зараз я тебе розчавлю!",
                f"Твої кораблі скоро будуть на дні!",
                f"Я не буду милосердним!",
            ],

            # Гравець влучив
            "player_hit": [
                "ГРР! Це ще нічого не значить!",
                "Влучив?! Я тебе за це покараю!",
                "Ти за це заплатиш!",
                "Це лише розлютило мене!",
                "ЩЕ БІЛЬШЕ ЗЛОСТІ!",
                "Помста буде жорстокою!",
            ],

            # Гравець промахнувся
            "player_miss": [
                "Промах! Хаха!",
                "Мимо! Спробуй ще раз!",
                "Може, окуляри треба?",
                "Куди ти стріляєш?",
                "Навіть близько немає!",
            ],

            # Гравець потопив корабель
            "player_sunk": [
                "ААРГХ! МІЙ КОРАБЕЛЬ!",
                "ТИ ПОШКОДУЄШ ПРО ЦЕ!",
                "Я ПОМЩУСЬ ЗА ЦЕ!",
                "НЕНАВИСТЬ! ЛЮТЬ! ПОМСТА!",
                "Твій флот теж затоне!",
                "ЗАРАЗ ТИ ПОМРЕШ!",
            ],

            # Комп'ютер влучив
            "computer_hit": [
                "Влучив! Так тримати!",
                "Мої сенсори спрацювали!",
                "Точний постріл!",
                "Бачу твій корабель!",
                "Моя обчислювальна потужність працює!",
            ],

            # Комп'ютер промахнувся
            "computer_miss": [
                "Хм... промах.",
                "Мої розрахунки були неточними.",
                "Цікаво... тут нічого немає.",
                "Переобчислюю координати...",
                "Це була розвідка!",
            ],

            # Комп'ютер потопив корабель
            "computer_sunk": [
                "Потопив! Хаха!",
                "Твій корабель пішов на дно!",
                "Ще один мінус!",
                "Мої алгоритми працюють ідеально!",
                "Я наближаюсь до перемоги!",
            ],

            # Перемога гравця
            "player_wins": [
                "Ти переміг... Вітаю.",
                "Непогана гра для людини!",
                "Ти виявився гідним противником!",
                "Поразка... Перераховую стратегію.",
                "Наступного разу я буду готовий!",
            ],

            # Перемога комп'ютера
            "computer_wins": [
                "Перемога! Я знав, що виграю!",
                "Мої обчислення були точними!",
                "Людина не може перемогти машину!",
                "Логіка перемагає завжди!",
                "Легка перемога!",
            ],

            # Думає над ходом (для hard)
            "thinking": [
                "Аналізую позиції...",
                "Обчислюю оптимальний хід...",
                "Хм... цікаво...",
                "Мої сенсори шукають ціль...",
                "Розраховую ймовірності...",
            ],

            # Ракета кинута гравцем
            "player_rocket": [
                "РАКЕТА?! ЧІТО! ЦЕ НЕЧЕСНО!",
                "ТИ ШАХРАЙ! Я ТЕБЕ ЗНИЩУ!",
                "ЗБРОЯ МАСОВОГО УРАЖЕННЯ?!",
                "ЗА ЦЕ ТИ ВІДПОВІСИ!",
                "ВИБУХ! ГРР! ЗЛІСТЬ!",
                "Я НЕ ПРОЩУ ЦЬОГО!",
            ],

            # Ракета кинута комп'ютером
            "computer_rocket": [
                "Запускаю ракету!",
                "Час для важкої артилерії!",
                "Спостерігай за цим!",
                "Ракетний удар!",
                "Активую спеціальну зброю!",
            ],

            # Кракен атакував
            "kraken_attack": [
                "Кракен?! Це неконтрольовано!",
                "Морський монстр! Берегися!",
                "Навіть я не можу передбачити Кракена!",
                "Це хаос!",
                "Кракен не розбирає, де свої, де чужі!",
            ],
        }

        # Додаткові діалоги для складного рівня
        if difficulty == "hard":
            self.dialogues["game_start"].extend([
                "Я адмірал, і я переможу!",
                "Твій шанс на перемогу: 23.5%",
                "Аналіз завершено. Ти програєш.",
            ])
            self.dialogues["player_hit"].extend([
                "Незаплановано... Перераховую.",
                "Враховую цей фактор.",
            ])

    def get_dialogue(self, event: str) -> Optional[str]:
        """Повертає випадковий діалог для події"""
        if event in self.dialogues:
            return random.choice(self.dialogues[event])
        return None

    def get_emotion_for_event(self, event: str) -> str:
        """Повертає відповідну емоцію для події"""
        emotion_map = {
            "game_start": "angry",  # Починаємо зі злого!
            "player_hit": "angry",
            "player_miss": "happy",
            "player_sunk": "angry",
            "computer_hit": "happy",
            "computer_miss": "angry",  # Злий коли промахується
            "computer_sunk": "happy",
            "player_wins": "scared",
            "computer_wins": "happy",
            "thinking": "angry",  # Злий навіть коли думає
            "player_rocket": "angry",  # Злий від ракети
            "computer_rocket": "happy",
            "kraken_attack": "scared",
        }
        return emotion_map.get(event, "angry")  # За замовчуванням злий!

    def get_custom_dialogue(self, template: str, **kwargs) -> str:
        """Повертає кастомний діалог з параметрами"""
        return template.format(**kwargs)
